const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets-sb/EditableColor-CtBrJZe_.js","assets-sb/scoreboard-BHT3jrlv.js","assets-sb/scoreboard-Duy2gOv0.css"])))=>i.map(i=>d[i]);
import{l as h,c as u,a as i,d as e,n as Ot,F as Z,i as F,x as H,B as N,o as Et,Z as Kt,r as at,f as I,b as C,u as n,t as f,e as rt,K as R,G as J,w as X,V as Lt,a4 as Ut,I as Vt,a3 as ct,q as dt,J as ut,L as qt,_ as zt}from"./scoreboard-BHT3jrlv.js";import{a as Pt}from"./useSoundEffect-DGUD-jaS.js";import{u as Ft,t as Ht,f as Jt,m as Xt}from"./useResilientTimer-CW9MET0J.js";import{_ as Zt}from"./_plugin-vue_export-helper-C8tdCacw.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},g=new r.Error().stack;g&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[g]="4ed10be1-a089-47d4-a4f8-7360526fcfc3",r._sentryDebugIdIdentifier="sentry-dbid-4ed10be1-a089-47d4-a4f8-7360526fcfc3")}catch{}})();const Qt={class:"row flex-fill d-flex flex-column"},Wt={key:0},Yt={key:1},te={class:"row flex-fill"},ee={class:"col-6 d-flex flex-column align-items-stretch justify-content-center"},oe={class:"row flex-fill"},se={class:"col-6 d-flex flex-column align-items-stretch justify-content-center"},ne={class:"row flex-fill"},le={__name:"GameClockCompactControl",props:["timer_running"],emits:["toggle","reset","increment"],setup(r,{emit:g}){const m=r,c=g,w=h(()=>m.timer_running);return(a,l)=>(i(),u(Z,null,[l[6]||(l[6]=e("div",{class:"row compact-header"},[e("h3",{class:"fs-6 d-flex align-items-center m-0 justify-content-center"},"Timer")],-1)),e("div",Qt,[e("button",{class:Ot(["btn btn-compact-timer-control rounded-0",{stop:w.value,start:!w.value}]),onClick:l[0]||(l[0]=v=>c("toggle")),style:{flex:"5"}},[w.value?(i(),u("span",Wt,"Stop")):(i(),u("span",Yt,"Start"))],2),e("button",{id:"btn-timer-reset",class:"btn btn-compact-timer-reset rounded-0",onClick:l[1]||(l[1]=v=>c("reset")),style:{flex:"4"}},"Reset")]),e("div",te,[e("div",ee,[e("div",oe,[e("button",{id:"btn-timer-plus-1",class:"btn btn-compact-timer-time-control rounded-0",onClick:l[2]||(l[2]=v=>c("increment",1))}," +1 "),e("button",{id:"btn-timer-minus-1",class:"btn btn-compact-timer-time-control rounded-0",onClick:l[3]||(l[3]=v=>c("increment",-1))}," -1 ")])]),e("div",se,[e("div",ne,[e("button",{id:"btn-timer-plus-60",class:"btn btn-compact-timer-time-control rounded-0",onClick:l[4]||(l[4]=v=>c("increment",60))}," +60 "),e("button",{id:"btn-timer-minus-60",class:"btn btn-compact-timer-time-control rounded-0",onClick:l[5]||(l[5]=v=>c("increment",-60))}," -60 ")])])])],64))}},ie={class:"d-flex flex-column justify-content-around","data-testid":"game-clock-control"},ae={id:"displayed-time-timer",class:"displayed-time font-monospace"},re={class:"w-100 d-flex justify-content-around mb-3"},ce={key:0},de={key:1},ue={class:"row row-cols-1 row-cols-md-2 g-4"},me={class:"col"},pe=["value"],be={key:0,class:"mb-4"},fe=["value"],ve={class:"col"},ke={class:"form-check"},he={class:"form-check mt-1"},ge={id:"displayed-time-shotclock",class:"displayed-time font-monospace"},we={class:"w-100 d-flex justify-content-around mb-3"},ye=["disabled"],_e={key:0},Ce={key:1},Se=["id"],Te=["id"],xe={id:"shot-clock-label",class:"mb-0"},De=["value"],Ie={class:"mt-1"},Re=["value"],Me={class:"mt-3"},$e={class:"mt-1"},mt=499,Ge=120,Be={__name:"GameClockResilient",props:{score_data:{type:Object,required:!0},scoreboard_ref:{type:Object,required:!1},mainTimer:{type:Object,required:!0},shotclock:{type:Object,required:!1,default:()=>Ft({state:at(Ht({duration:3e4}))})},appearance_shotclock:{type:Object,required:!1,default(){return{bg:"#000000",text:"#ffffff",runsAfterGameClockStopped:!1}}},possession_team:{type:String,required:!1}},emits:["timer-toggled"],setup(r,{emit:g}){const m=F("config"),c=F("control_mode"),w=qt(()=>zt(()=>import("./EditableColor-CtBrJZe_.js"),__vite__mapDeps([0,1,2]))),a=r,{startTimer:l,pauseTimer:v,changeDirection:pt,resetAndContinueTimer:bt,setDuration:ft,adjustDuration:vt,setResetTime:kt,timerRunning:p,countsUp:O,displayLocalDuration:ht,resetTimeBreakdown:gt,formats:wt,format:E}=a.mainTimer,M=h(()=>a.score_data.board.show_timer),{resetTime:Q,timerRunning:K,displayLocalDuration:yt,pauseTimer:S,startTimer:W,setResetTime:_t,setDuration:Y,adjustDuration:Ct,timerConfig:St,commitConfig:Tt,status:tt,resetTimer:L}=a.shotclock,y=H(()=>a.score_data.board.show_shotclock),xt=F("lastKeypress"),Dt=g;N(xt,async o=>{o===" "&&(console.debug("[GameClock] Spacebar was pressed"),await U())}),a.mainTimer.on("startTimer",({start_time:o})=>{if(!y.value){console.log("[GameClock] Shot clock is not visible and will be not started/stopped");return}console.log("[GameClock] Started shot clock"),W(()=>o)}),a.mainTimer.on("pauseTimer",()=>{if(console.log("[GameClock] Main timer stopped"),!y.value){console.log("[GameClock] Shot clock is not visible and will be not started/stopped");return}console.log("[GameClock] Stopped shot clock"),S()}),Et(()=>{console.log("[GameClock] ⏲️ Mounted Resilient GameClock"+(y.value?" with shotclock":""))}),Kt(()=>{v()});const et=()=>O.value?Date.now():Date.now()+1e3,U=async()=>{p.value?await v():await l(et),Dt("timer-toggled",{running:p.value})},V=()=>bt(null,p.value?et:()=>Date.now()),{playBuzzer:$}=Pt();a.mainTimer.on("timerEnded",()=>{$(),nt.value||(console.log("[GameClock] Stopped shot clock"),S())}),a.shotclock.on("timerEnded",()=>{$()});const T=o=>{vt(o,"s")},G=o=>{Ct(o,"s")},It=o=>Jt(Xt(o),{showHours:!1,showMilliseconds:!1,showMinutes:!0,showSeconds:!1,minutesPad:1}),ot=H(()=>gt.value.totalMinutes),_=at(ot.value),st=o=>!o||isNaN(o)||parseInt(o,10)<1,Rt=async o=>{const t=o.target.value;if(st(t)){_.value=t;return}const d=parseInt(t,10);if(d>Ge){o.target.value=_.value;return}const b=d*60*1e3;_.value=It(b),await kt(b),O.value||await ft(b)},Mt=()=>{st(_.value)&&(_.value=ot.value)},B=h({get(){return O.value?"up":"down"},async set(o){await V(),pt(o==="up")}}),q=o=>{let t=o.keyCode?o.keyCode:o.which;(t<48||t>57)&&o.preventDefault()},$t=o=>T(o),A=h(()=>St.value.short_reset_seconds),nt=h(()=>{var o;return((o=a.appearance_shotclock)==null?void 0:o.runsAfterGameClockStopped)||!1}),x=h(()=>Q.value/1e3),Gt=H(()=>a.possession_team),j=h(()=>m.sport==="FOOTBALL"?"Play clock":m.sport==="BASEBALL"?"Pitch clock":"Shot clock"),lt=async o=>{const t=Number(o.target.value);tt.value==="ended"?await L(t*1e3):(await _t(t*1e3),await Y(t*1e3))},Bt=()=>K.value?S():z(),z=async(o=Date.now())=>W(()=>o),At=async o=>{await Tt({short_reset_seconds:o}),await Y(o*1e3)},it=o=>At(Number(o.target.value)),P=async o=>{const t=o*1e3,d=p.value;await L(t+(d?mt:0),d&&tt.value!=="paused"?Date.now():null)},jt=h(()=>M.value?!p.value&&nt.value?!K.value:!p.value:!1);N(Gt,async(o,t)=>{console.log("[GameClock] possessionTeam "+o,t),await L(Q.value+mt),!(M.value&&!p.value)&&(o!=="NONE"?await z():await S())});const Nt=async(o,t,d,k)=>{const b=t-o,D=k-d;(b===2||b===3||D===2||D===3)&&await P(x.value)};return N(y,async o=>{o?await z():await S()}),N([()=>{var o;return((o=a.score_data.home)==null?void 0:o.score)??0},()=>{var o;return((o=a.score_data.away)==null?void 0:o.score)??0}],async([o,t],[d,k])=>{await Nt(d,o,k,t)}),(o,t)=>{var d,k,b,D;return i(),u(Z,null,[M.value&&n(c)!=="compact"?(i(),I(R,{key:0,defer:"",to:"#timer-control"},[e("div",ie,[e("div",ae,f(n(ht)),1),e("div",re,[e("button",{id:"btn-timer-plus-60",class:"btn btn-light btn-timer",onClick:t[0]||(t[0]=s=>T(60))}," +60 "),e("button",{id:"btn-timer-plus-1",class:"btn btn-light btn-timer",onClick:t[1]||(t[1]=s=>T(1))}," +1 "),e("button",{id:"btn-timer-minus-60",class:"btn btn-light btn-timer",onClick:t[2]||(t[2]=s=>T(-60))}," -60 "),e("button",{id:"btn-timer-minus-1",class:"btn btn-light btn-timer",onClick:t[3]||(t[3]=s=>T(-1))}," -1 ")]),e("button",{class:"btn btn-light w-100",style:{"min-width":"100px"},onClick:U},[n(p)?(i(),u("span",ce,"Stop")):(i(),u("span",de,"Start"))]),e("button",{class:"btn btn-outline-light w-100 mt-1",style:{"min-width":"100px"},onClick:t[4]||(t[4]=(...s)=>n($)&&n($)(...s))},t[16]||(t[16]=[e("i",{class:"bi bi-volume-up"},null,-1),rt(" Buzzer ")])),e("button",{id:"btn-timer-reset",class:"btn btn-outline-light w-100 mt-1",style:{"min-width":"100px"},onClick:V},t[17]||(t[17]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),rt(" Reset ")]))]),t[18]||(t[18]=e("div",{class:"text-center mt-3 small"},[e("a",{class:"text-white","data-bs-toggle":"collapse",href:"#timerInfo",role:"button"}," More information ")],-1)),t[19]||(t[19]=e("div",{id:"timerInfo",class:"collapse"},[e("div",{class:"d-flex flex-column justify-content-around"},[e("div",{class:"small mt-2 d-none d-md-block"},"💡 Use the spacebar to start and stop the timer. "),e("div",{class:"small mt-2 d-none d-md-block"},"💡 Keep this browser tab open and visible to ensure the timer runs properly. The timer must be started and stopped in the same browser tab. ")])],-1))])):C("",!0),n(c)==="compact"&&n(m).view==="ADMIN"?(i(),I(R,{key:1,to:"#timer-control-compact"},[J(le,{timer_running:n(p),onToggle:U,onReset:V,onIncrement:$t},null,8,["timer_running"])])):C("",!0),M.value&&n(m).view==="ADMIN"&&n(c)!=="compact"?(i(),I(R,{key:2,defer:"",to:"#timer-settings"},[e("div",ue,[e("div",me,[e("div",null,[t[20]||(t[20]=e("label",{for:"timer-default",class:"form-label"},"Timer length (mins)",-1)),e("input",{id:"timer-default",value:_.value,class:"form-control",max:"120",min:"1",placeholder:"maximum 120",type:"number",onBlur:Mt,onInput:Rt,onKeypress:q},null,40,pe)]),n(m).features.includes("time_format")?(i(),u("div",be,[t[21]||(t[21]=e("label",{class:"form-label",for:"timer-format"},"Format:",-1)),X(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>Ut(E)?E.value=s:null),id:"timer-format",class:"form-select"},[(i(!0),u(Z,null,Vt(n(wt),s=>(i(),u("option",{value:s,key:s},f(s),9,fe))),128))],512),[[Lt,n(E)]])])):C("",!0)]),e("div",ve,[e("div",ke,[X(e("input",{id:"timerDirectionUp","onUpdate:modelValue":t[6]||(t[6]=s=>B.value=s),class:"form-check-input",name:"timerDirection",type:"radio",value:"up"},null,512),[[ct,B.value]]),t[22]||(t[22]=e("label",{class:"form-check-label lh-1",for:"timerDirectionUp"}," Timer counts up ",-1))]),e("div",he,[X(e("input",{id:"timerDirectionDown","onUpdate:modelValue":t[7]||(t[7]=s=>B.value=s),class:"form-check-input",name:"timerDirection",type:"radio",value:"down"},null,512),[[ct,B.value]]),t[23]||(t[23]=e("label",{class:"form-check-label lh-1",for:"timerDirectionDown"}," Timer counts down ",-1))])])])])):C("",!0),y.value&&n(c)!=="compact"?(i(),I(R,{key:3,defer:"",to:"#shotclock"},[e("div",ge,f(n(yt)),1),e("div",we,[e("button",{id:"btn-timer-plus-60",class:"btn btn-light btn-timer",onClick:t[8]||(t[8]=s=>G(5))}," +5 "),e("button",{id:"btn-timer-plus-1",class:"btn btn-light btn-timer",onClick:t[9]||(t[9]=s=>G(1))}," +1 "),e("button",{id:"btn-timer-minus-60",class:"btn btn-light btn-timer",onClick:t[10]||(t[10]=s=>G(-1))}," -1 "),e("button",{id:"btn-timer-minus-1",class:"btn btn-light btn-timer",onClick:t[11]||(t[11]=s=>G(-5))}," -5 ")]),e("button",{disabled:jt.value,class:"btn btn-light w-100",style:{"min-width":"100px"},onClick:Bt},[n(K)?(i(),u("span",_e,"Stop")):(i(),u("span",Ce,"Start"))],8,ye),e("button",{id:"btn-shotclock-reset-"+x.value,class:"btn btn-outline-light w-100 mt-2",style:{"min-width":"100px"},onClick:t[12]||(t[12]=s=>P(x.value))}," Reset "+f(x.value),9,Se),e("button",{id:"btn-shotclock-reset-"+A.value,class:"btn btn-outline-light w-100 mt-2",style:{"min-width":"100px"},onClick:t[13]||(t[13]=s=>P(A.value))}," Reset "+f(A.value),9,Te)])):C("",!0),y.value&&n(m).view==="ADMIN"&&n(c)!=="compact"?(i(),I(R,{key:4,defer:"",to:"#shotclock-settings"},[e("div",null,[e("div",xe,f(j.value)+" duration",1),e("input",{id:"shotclock-duration",value:x.value,onInput:lt,class:"form-control",maxlength:"2",type:"number",onKeypress:q,onKeyup:dt(lt,["enter"])},null,40,De),e("div",Ie,f(j.value)+" duration (additional)",1),e("input",{id:"shotclock-additional-duration",value:A.value,onInput:it,class:"form-control",maxlength:"2",type:"number",onKeypress:q,onKeyup:dt(it,["enter"])},null,40,Re),e("div",Me,f(j.value)+" background:",1),J(n(w),{value:((k=(d=r.score_data)==null?void 0:d.board)==null?void 0:k.shotclock_bgcolor)||r.appearance_shotclock.bg,"component-id":"shotclock_bgcolor",onUpdateValue:t[14]||(t[14]=s=>n(ut)("board.shotclock_bgcolor","set",s,a))},null,8,["value"]),e("div",$e,f(j.value)+" text:",1),J(n(w),{value:((D=(b=r.score_data)==null?void 0:b.board)==null?void 0:D.shotclock_textcolor)||r.appearance_shotclock.text,"component-id":"shotclock_text-color",onUpdateValue:t[15]||(t[15]=s=>n(ut)("board.shotclock_textcolor","set",s,a))},null,8,["value"])])])):C("",!0)],64)}}},Ee=Zt(Be,[["__scopeId","data-v-f12daa8a"]]);export{Ee as G};
//# sourceMappingURL=GameClockResilient-Duh81Ax-.js.map
